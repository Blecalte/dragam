<!doctype html>
<html lang="pt-BR">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Dragam</title>
<link rel="icon" href="https://icons.iconarchive.com/icons/igh0zt/ios7-style-metro-ui/256/MetroUI-Browser-Comodo-Dragon-icon.png" type="image/png" />
<style>
  :root {
    --bg-start: #050005;
    --bg-end: #000000;
    --accent: #ff0050;
    --muted: #cfcfcf;
    --font: 'Segoe UI', Roboto, Arial, sans-serif;
    --shadow: rgba(255, 0, 80, 0.25);
    --scrollbar-bg: rgba(255, 0, 80, 0.15);
  }
  html, body {
    margin: 0; padding: 0; height: 100%;
    background: linear-gradient(180deg, var(--bg-start), var(--bg-end));
    color: white;
    font-family: var(--font);
    overflow: hidden;
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
  }
  ::-webkit-scrollbar {
    width: 8px;
  }
  ::-webkit-scrollbar-track {
    background: transparent;
  }
  ::-webkit-scrollbar-thumb {
    background: var(--scrollbar-bg);
    border-radius: 4px;
  }
  header {
    position: fixed;
    top: 0; left: 0; right: 0;
    height: 60px;
    background: rgba(0, 0, 0, 0.9);
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 0 24px;
    z-index: 1000;
    border-bottom: 1px solid rgba(255, 255, 255, 0.12);
    backdrop-filter: blur(8px);
    box-shadow: 0 2px 8px var(--shadow);
  }
  header h1 {
    font-size: 26px;
    color: var(--accent);
    margin: 0;
    letter-spacing: 1.2px;
    font-weight: 900;
    user-select: none;
    text-shadow: 0 0 6px var(--accent);
  }
  .header-right {
    display: flex;
    align-items: center;
    gap: 12px;
  }
  #userIcon {
    width: 36px;
    height: 36px;
    border-radius: 50%;
    object-fit: cover;
    border: 2px solid var(--accent);
    cursor: pointer;
  }
  header button, #loginBtn {
    background: var(--accent);
    border: none;
    border-radius: 50%;
    width: 48px;
    height: 48px;
    color: white;
    font-size: 28px;
    cursor: pointer;
    transition: transform 0.25s, box-shadow 0.25s;
    box-shadow: 0 0 8px var(--accent);
    display: flex;
    align-items: center;
    justify-content: center;
  }
  header button:hover, header button:focus,
  #loginBtn:hover, #loginBtn:focus {
    transform: scale(1.15);
    box-shadow: 0 0 14px var(--accent);
    outline: none;
  }
  #searchInput {
    background: #222;
    border: none;
    border-radius: 12px;
    padding: 8px 16px;
    font-size: 16px;
    color: white;
    width: 180px;
    transition: box-shadow 0.3s;
  }
  #searchInput:focus {
    outline: none;
    box-shadow: 0 0 8px var(--accent);
  }
  #userArea {
    color: var(--accent);
    font-weight: 700;
    user-select: none;
    display: flex;
    align-items: center;
    gap: 8px;
  }
  .app {
    padding-top: 60px;
    height: 100vh;
    position: relative;
    overflow: hidden;
    background: transparent;
    display: flex;
    justify-content: center;
  }
  .feed {
    height: 100%;
    width: 100%;
    max-width: 600px;
    position: relative;
    touch-action: none;
    outline: none;
    -webkit-overflow-scrolling: touch;
  }
  .reel {
    height: 100vh;
    display: flex;
    align-items: flex-end;
    justify-content: space-between;
    padding: 24px 24px 48px;
    box-sizing: border-box;
    flex-direction: row;
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    transition: transform 0.5s cubic-bezier(0.4, 0, 0.2, 1);
    will-change: transform;
    border-radius: 20px;
    box-shadow: 0 8px 32px var(--shadow);
    background: rgba(10, 0, 10, 0.8);
    backdrop-filter: blur(12px);
    user-select: none;
  }
  video {
    position: absolute;
    inset: 0;
    width: 100%;
    height: 100%;
    object-fit: cover;
    border-radius: 20px;
    filter: brightness(0.9);
    background: #000;
  }
  .meta {
    z-index: 2;
    background: linear-gradient(180deg, transparent, rgba(0, 0, 0, 0.85));
    padding: 18px 22px;
    border-radius: 14px;
    max-width: 65%;
    user-select: text;
    box-shadow: 0 0 12px rgba(0,0,0,0.6);
  }
  .meta .user {
    font-weight: 900;
    font-size: 17px;
    color: var(--accent);
    margin-bottom: 6px;
    text-shadow: 0 0 4px var(--accent);
  }
  .meta .caption {
    font-size: 15px;
    color: var(--muted);
    line-height: 1.4;
    white-space: pre-wrap;
  }
  .actions {
    z-index: 2;
    display: flex;
    flex-direction: column;
    gap: 18px;
    align-items: center;
    user-select: none;
  }
  .action {
    width: 56px;
    height: 56px;
    border-radius: 50%;
    background: rgba(0, 0, 0, 0.65);
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: transform 0.25s, background 0.25s, box-shadow 0.25s;
    font-size: 26px;
    line-height: 1;
    box-shadow: 0 0 8px rgba(0,0,0,0.3);
    position: relative;
  }
  .action:hover, .action:focus {
    transform: scale(1.2);
    background: rgba(255, 255, 255, 0.15);
    box-shadow: 0 0 16px var(--accent);
    outline: none;
  }
  .action .count {
    position: absolute;
    bottom: 6px;
    right: 6px;
    background: var(--accent);
    color: #111;
    font-weight: 900;
    font-size: 12px;
    border-radius: 8px;
    padding: 2px 6px;
    box-shadow: 0 0 6px var(--accent);
    user-select: none;
  }
  .progress-wrap {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 4px;
    background: rgba(255, 255, 255, 0.15);
    border-radius: 2px;
    z-index: 3;
  }
  .progress {
    height: 100%;
    width: 0;
    background: var(--accent);
    transition: width 0.1s linear;
    border-radius: 2px;
  }
  .modal {
    position: fixed;
    inset: 0;
    background: rgba(0, 0, 0, 0.9);
    display: flex;
    align-items: center;
    justify-content: center;
    opacity: 0;
    pointer-events: none;
    transition: opacity 0.3s ease;
    z-index: 2000;
  }
  .modal.open {
    opacity: 1;
    pointer-events: auto;
  }
  .modal-content {
    background: #111;
    padding: 28px 30px;
    border-radius: 16px;
    width: 90%;
    max-width: 480px;
    box-shadow: 0 0 25px var(--accent);
    font-size: 16px;
    color: white;
    display: flex;
    flex-direction: column;
    gap: 14px;
  }
  .modal-content h2 {
    margin: 0 0 20px 0;
    font-weight: 900;
    color: var(--accent);
    text-align: center;
    letter-spacing: 1.3px;
    user-select: none;
    text-shadow: 0 0 8px var(--accent);
  }
  .modal-content input,
  .modal-content textarea {
    width: 100%;
    padding: 14px 16px;
    border: none;
    border-radius: 10px;
    background: #222;
    color: white;
    font-size: 15px;
    font-family: var(--font);
    resize: none;
    box-sizing: border-box;
    transition: background 0.3s;
  }
  .modal-content input:focus,
  .modal-content textarea:focus {
    outline: none;
    background: #333;
    box-shadow: 0 0 8px var(--accent);
  }
  .modal-content button {
    padding: 14px;
    background: var(--accent);
    border: none;
    color: white;
    border-radius: 10px;
    cursor: pointer;
    font-weight: 900;
    letter-spacing: 0.7px;
    font-size: 18px;
    transition: background 0.3s, box-shadow 0.3s;
    user-select: none;
    box-shadow: 0 0 12px var(--accent);
  }
  .modal-content button:hover,
  .modal-content button:focus {
    background: #e60045;
    box-shadow: 0 0 20px #e60045;
    outline: none;
  }
  /* Chat modal styles */
  #chatModal .modal-content {
    max-height: 500px;
    display: flex;
    flex-direction: column;
  }
  #chatMessages {
    flex-grow: 1;
    background: #222;
    border-radius: 12px;
    padding: 12px;
    overflow-y: auto;
    margin-bottom: 12px;
    font-size: 14px;
    line-height: 1.3;
  }
  #chatMessages .message {
    display: flex;
    align-items: flex-start;
    margin: 8px 0;
    gap: 10px;
  }
  #chatMessages .message img {
    width: 36px;
    height: 36px;
    border-radius: 50%;
    object-fit: cover;
    border: 1.5px solid var(--accent);
    flex-shrink: 0;
  }
  #chatMessages .message .text {
    background: rgba(255,255,255,0.1);
    padding: 8px 12px;
    border-radius: 12px;
    max-width: 80%;
    word-wrap: break-word;
    color: white;
    font-size: 14px;
    user-select: text;
  }
  #chatInput {
    width: 100%;
    padding: 12px 14px;
    border-radius: 12px;
    border: none;
    font-size: 15px;
    font-family: var(--font);
    background: #222;
    color: white;
    box-sizing: border-box;
  }
  #chatInput:focus {
    outline: none;
    box-shadow: 0 0 8px var(--accent);
  }
  #chatSendBtn {
    margin-top: 10px;
    padding: 12px;
    background: var(--accent);
    border: none;
    color: white;
    font-weight: 900;
    font-size: 16px;
    border-radius: 12px;
    cursor: pointer;
    transition: background 0.3s, box-shadow 0.3s;
  }
  #chatSendBtn:hover, #chatSendBtn:focus {
    background: #e60045;
    box-shadow: 0 0 14px #e60045;
    outline: none;
  }
  /* Responsive */
  @media (max-width: 900px) {
    .reel {
      border-radius: 0;
      box-shadow: none;
      padding: 20px;
      background: transparent;
      backdrop-filter: none;
    }
    video {
      border-radius: 0;
      filter: none;
    }
    .meta {
      max-width: 80%;
      padding: 12px 14px;
      background: linear-gradient(180deg, transparent, rgba(0,0,0,0.7));
      box-shadow: none;
    }
    .actions {
      gap: 12px;
    }
    .action {
      width: 46px;
      height: 46px;
      font-size: 20px;
    }
    header {
      padding: 0 16px;
    }
    header h1 {
      font-size: 20px;
    }
    header button {
      width: 40px;
      height: 40px;
      font-size: 24px;
    }
    #searchInput {
      width: 130px;
    }
  }
</style>
</head>
<body>
<header>
  <h1>Dragam</h1>
  <div class="header-right">
    <input type="text" id="searchInput" placeholder="Buscar usuário..." aria-label="Buscar usuário" />
    <div id="userArea" tabindex="0" aria-live="polite" aria-atomic="true" role="region">
      <img id="userIcon" src="" alt="Ícone do usuário" title="Clique para alterar seu ícone" tabindex="0" />
      <span id="userNameText">Não logado</span>
    </div>
    <button id="loginBtn" title="Logar usuário" aria-label="Logar usuário">👤</button>
    <button id="addBtn" aria-label="Postar novo Reels">+</button>
  </div>
</header>
<div class="app">
  <div class="feed" id="feed" tabindex="0" aria-live="polite" aria-atomic="true"></div>
</div>

<!-- Upload Modal -->
<div class="modal" id="uploadModal" role="dialog" aria-modal="true" aria-labelledby="modalTitle" aria-hidden="true">
  <div class="modal-content">
    <h2 id="modalTitle">Postar Reels</h2>
    <input type="file" id="videoFile" accept="video/mp4,video/webm" aria-label="Selecionar arquivo de vídeo" />
    <input type="text" id="username" placeholder="Seu usuário" aria-label="Nome do usuário" />
    <textarea id="caption" placeholder="Legenda" rows="3" aria-label="Legenda do vídeo"></textarea>
    <button id="postBtn">Postar</button>
  </div>
</div>

<!-- Chat Modal -->
<div class="modal" id="chatModal" role="dialog" aria-modal="true" aria-labelledby="chatTitle" aria-hidden="true">
  <div class="modal-content">
    <h2 id="chatTitle">Comentários</h2>
    <div id="chatMessages" aria-live="polite" aria-atomic="false" tabindex="0"></div>
    <input type="text" id="chatInput" placeholder="Escreva um comentário..." aria-label="Campo para escrever comentário" />
    <button id="chatSendBtn">Enviar</button>
  </div>
</div>

<!-- User Icon Upload Modal -->
<div class="modal" id="iconUploadModal" role="dialog" aria-modal="true" aria-labelledby="iconModalTitle" aria-hidden="true">
  <div class="modal-content">
    <h2 id="iconModalTitle">Alterar Ícone do Usuário</h2>
    <input type="file" id="iconFile" accept="image/png, image/jpeg, image/jpg, image/gif" aria-label="Selecionar imagem para ícone" />
    <button id="iconSaveBtn">Salvar</button>
  </div>
</div>

<script>
  const feed = document.getElementById('feed');
  const modal = document.getElementById('uploadModal');
  const chatModal = document.getElementById('chatModal');
  const addBtn = document.getElementById('addBtn');
  const postBtn = document.getElementById('postBtn');
  const loginBtn = document.getElementById('loginBtn');
  const userArea = document.getElementById('userArea');
  const searchInput = document.getElementById('searchInput');
  const chatMessages = document.getElementById('chatMessages');
  const chatInput = document.getElementById('chatInput');
  const chatSendBtn = document.getElementById('chatSendBtn');
  const userIconImg = document.getElementById('userIcon');
  const userNameText = document.getElementById('userNameText');

  const iconUploadModal = document.getElementById('iconUploadModal');
  const iconFileInput = document.getElementById('iconFile');
  const iconSaveBtn = document.getElementById('iconSaveBtn');

  let reels = [];
  let likes = {};
  let comments = {};
  let loggedUser = null;
  let userIcons = {}; // { username: base64string }
  let current = 0;
// Pré-carregar alguns reels exemplo (links públicos free para RPG)
const sampleReels = [
  {
    video: 'https://interactive-examples.mdn.mozilla.net/media/cc0-videos/flower.webm',
    user: 'rpgmaster',
    caption: 'Explorando masmorras épicas! #RPG #Dungeon',
  },
  {
    video: 'https://interactive-examples.mdn.mozilla.net/media/cc0-videos/bee.webm',
    user: 'fantasyworld',
    caption: 'Criando personagens incríveis para RPG! #Fantasy #RPG',
  },
  {
    video: 'https://interactive-examples.mdn.mozilla.net/media/cc0-videos/tank.webm',
    user: 'adventuretime',
    caption: 'Batalhas intensas na campanha de hoje! #RPGBattle',
  },
];

// Inicializa reels com os exemplos
reels = sampleReels.slice();
reels.forEach((r, i) => {
  likes[i] = 0;
  comments[i] = [];
});

// Função para renderizar reels no feed
function renderReels() {
  feed.innerHTML = '';
  reels.forEach((reel, i) => {
    const reelDiv = document.createElement('div');
    reelDiv.className = 'reel';
    reelDiv.style.transform = `translateY(${(i - current) * 100}vh)`;
    reelDiv.setAttribute('data-index', i);
    reelDiv.setAttribute('tabindex', '0');
    reelDiv.setAttribute('aria-label', `Vídeo de ${reel.user}, legenda: ${reel.caption}`);
    reelDiv.innerHTML = `
      <video src="${reel.video}" preload="metadata" playsinline muted loop></video>
      <div class="meta">
        <div class="user">@${reel.user}</div>
        <div class="caption">${reel.caption}</div>
      </div>
      <div class="actions">
        <div class="action likeBtn" role="button" tabindex="0" aria-label="Curtir vídeo">
          ❤️ <span class="count">${likes[i]}</span>
        </div>
        <div class="action commentBtn" role="button" tabindex="0" aria-label="Comentários">
          💬
        </div>
      </div>
      <div class="progress-wrap"><div class="progress"></div></div>
    `;
    feed.appendChild(reelDiv);

    const videoEl = reelDiv.querySelector('video');
    videoEl.play();

    // Like button
    const likeBtn = reelDiv.querySelector('.likeBtn');
    likeBtn.onclick = () => {
      likes[i]++;
      likeBtn.querySelector('.count').textContent = likes[i];
    };
    likeBtn.onkeypress = e => {
      if (e.key === 'Enter' || e.key === ' ') likeBtn.onclick();
    };

    // Comment button opens chat modal
    const commentBtn = reelDiv.querySelector('.commentBtn');
    commentBtn.onclick = () => openChat(i);
    commentBtn.onkeypress = e => {
      if (e.key === 'Enter' || e.key === ' ') commentBtn.onclick();
    };
  });
  updateProgress();
}

// Atualiza barra de progresso do vídeo atual
function updateProgress() {
  const reelDivs = document.querySelectorAll('.reel');
  reelDivs.forEach(div => {
    const index = +div.getAttribute('data-index');
    const video = div.querySelector('video');
    const progressBar = div.querySelector('.progress');
    if (index === current) {
      video.ontimeupdate = () => {
        const pct = (video.currentTime / video.duration) * 100;
        progressBar.style.width = pct + '%';
      };
    } else {
      const progressBar = div.querySelector('.progress');
      if (progressBar) progressBar.style.width = '0%';
      if (video) video.ontimeupdate = null;
    }
  });
}

// Navegação entre reels via teclado e wheel
function changeReel(newIndex) {
  if (newIndex < 0 || newIndex >= reels.length) return;
  current = newIndex;
  const reelDivs = document.querySelectorAll('.reel');
  reelDivs.forEach(div => {
    const index = +div.getAttribute('data-index');
    div.style.transform = `translateY(${(index - current) * 100}vh)`;
  });
  updateProgress();
}

// Eventos para navegação
feed.addEventListener('wheel', e => {
  if (e.deltaY > 0) changeReel(current + 1);
  else if (e.deltaY < 0) changeReel(current - 1);
});
document.addEventListener('keydown', e => {
  if (document.activeElement === chatInput) return; // não interferir ao digitar
  if (e.key === 'ArrowDown') changeReel(current + 1);
  else if (e.key === 'ArrowUp') changeReel(current - 1);
});

// Abrir modal postar reels
addBtn.onclick = () => {
  if (!loggedUser) alert('Por favor, faça login primeiro clicando no ícone de usuário.');
  else {
    modal.classList.add('open');
    modal.setAttribute('aria-hidden', 'false');
  }
};
// Fechar modais ao clicar fora
document.querySelectorAll('.modal').forEach(m => {
  m.addEventListener('click', e => {
    if (e.target === m) closeModals();
  });
});
function closeModals() {
  document.querySelectorAll('.modal').forEach(m => {
    m.classList.remove('open');
    m.setAttribute('aria-hidden', 'true');
  });
}
// Postar reels
postBtn.onclick = () => {
  const fileInput = document.getElementById('videoFile');
  const usernameInput = document.getElementById('username');
  const captionInput = document.getElementById('caption');
  if (!fileInput.files.length) {
    alert('Selecione um vídeo!');
    return;
  }
  if (!usernameInput.value.trim()) {
    alert('Informe seu nome de usuário!');
    return;
  }
  const file = fileInput.files[0];
  const reader = new FileReader();
  reader.onload = () => {
    reels.push({
      video: reader.result,
      user: usernameInput.value.trim(),
      caption: captionInput.value.trim(),
    });
    likes[reels.length - 1] = 0;
    comments[reels.length - 1] = [];
    usernameInput.value = '';
    captionInput.value = '';
    fileInput.value = '';
    closeModals();
    current = reels.length - 1;
    renderReels();
  };
  reader.readAsDataURL(file);
};

// Login / Logout
loginBtn.onclick = () => {
  if (loggedUser) {
    if (confirm('Deseja sair?')) {
      loggedUser = null;
      userNameText.textContent = 'Não logado';
      userIconImg.src = '';
      renderReels();
    }
  } else {
    const name = prompt('Digite seu nome de usuário:');
    if (name && name.trim()) {
      loggedUser = name.trim();
      userNameText.textContent = loggedUser;
      userIconImg.src = userIcons[loggedUser] || '';
      renderReels();
    }
  }
};

// Clicar no ícone para alterar avatar
userIconImg.onclick = () => {
  if (!loggedUser) {
    alert('Faça login para alterar seu ícone!');
    return;
  }
  iconUploadModal.classList.add('open');
  iconUploadModal.setAttribute('aria-hidden', 'false');
};

// Salvar ícone de usuário
iconSaveBtn.onclick = () => {
  if (!iconFileInput.files.length) {
    alert('Selecione uma imagem!');
    return;
  }
  const file = iconFileInput.files[0];
  const reader = new FileReader();
  reader.onload = () => {
    userIcons[loggedUser] = reader.result;
    userIconImg.src = reader.result;
    iconFileInput.value = '';
    closeModals();
    renderReels();
  };
  reader.readAsDataURL(file);
};

// Abrir chat de comentários
function openChat(index) {
  if (!loggedUser) {
    alert('Faça login para comentar!');
    return;
  }
  chatModal.classList.add('open');
  chatModal.setAttribute('aria-hidden', 'false');
  chatMessages.innerHTML = '';
  comments[index].forEach(cmt => {
    const div = document.createElement('div');
    div.className = 'message';
    div.innerHTML = `
      <img src="${userIcons[cmt.user] || 'https://icons.iconarchive.com/icons/paomedia/small-n-flat/1024/user-male-icon.png'}" alt="Ícone do usuário ${cmt.user}" />
      <div class="text"><strong>@${cmt.user}:</strong> ${cmt.text}</div>
    `;
    chatMessages.appendChild(div);
  });
  chatSendBtn.onclick = () => sendComment(index);
  chatInput.value = '';
  chatInput.focus();
}

// Enviar comentário
function sendComment(index) {
  const txt = chatInput.value.trim();
  if (!txt) return;
  comments[index].push({ user: loggedUser, text: txt });
  const div = document.createElement('div');
  div.className = 'message';
  div.innerHTML = `
    <img src="${userIcons[loggedUser] || 'https://icons.iconarchive.com/icons/paomedia/small-n-flat/1024/user-male-icon.png'}" alt="Ícone do usuário ${loggedUser}" />
    <div class="text"><strong>@${loggedUser}:</strong> ${txt}</div>
  `;
  chatMessages.appendChild(div);
  chatInput.value = '';
  chatInput.focus();
  chatMessages.scrollTop = chatMessages.scrollHeight;
}

// Busca simples por usuário
searchInput.oninput = () => {
  const val = searchInput.value.trim().toLowerCase();
  if (!val) {
    renderReels();
    return;
  }
  const filtered = reels.filter(r => r.user.toLowerCase().includes(val));
  feed.innerHTML = '';
  filtered.forEach((reel, i) => {
    const reelDiv = document.createElement('div');
    reelDiv.className = 'reel';
    reelDiv.style.transform = `translateY(${i * 100}vh)`;
    reelDiv.innerHTML = `
      <video src="${reel.video}" preload="metadata" playsinline muted loop></video>
      <div class="meta">
        <div class="user">@${reel.user}</div>
        <div class="caption">${reel.caption}</div>
      </div>
      <div class="actions">
        <div class="action likeBtn" role="button" tabindex="0" aria-label="Curtir vídeo">
          ❤️ <span class="count">${likes[i]}</span>
        </div>
        <div class="action commentBtn" role="button" tabindex="0" aria-label="Comentários">
          💬
        </div>
      </div>
      <div class="progress-wrap"><div class="progress"></div></div>
    `;
    feed.appendChild(reelDiv);
  });
};

// Inicializa
renderReels();

</script>
</body>
</html>
